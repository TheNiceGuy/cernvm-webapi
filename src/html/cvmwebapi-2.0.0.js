window.CVM={version:"2.0.0"};(function(b){var f="data:image/gif;base64,R0lGODlhIAAgALMAAGZmZnl5eczMzJ+fn////7Ozs4yMjGtra+Li4nFxcaampgAAAAAAAAAAAAAAAAAAACH5BAEHAAQALAAAAAAgACAAAASjkMhJq704681JKV04JYkYDgAwmBuSpgibGS9gyJdQpwJeBTtAwDcpBFMgYuJ1WKZKPlRqSACmVjLXK2l8xVi0raSbupl0Ne6uJ7K+zOEXtUOWS9zijrNGxT87UjtURyothAASh18YcUGJhGY5hzZ7R2wWfpNHcxR1lmiHSRSVQQoSCpNQE4GQEo1HWARamgcHmjCut7pvBKC7ugKZv4ecRMYsEQA7";var i="data:image/gif;base64,R0lGODlhIAAgAMQAAGZmZnt7e8TExK2treXl5dXV1Wtra4qKivj4+L29vd7e3pGRke/v78zMzLW1tYSEhHR0dJmZmQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEHAAgALAAAAAAgACAAAAXUICKOZGmeKMoUguMIBZPOY3IAeI4fCX0KEJ0wBxH4RouhMrfwEQLLKCBAmEGl0UAqmRUQBsumSYBtjG5KYykoVYwiS0gpgQUsZAVp71zHsaMHIwx9hAAyCHmACQoEDn9RBSJkSweMI5NSag51VSJ1DiKbWJ0In5JYBiOJmSKrYSNgWJEIg3ojV1KHCGhLnbVSgTVRciINdXsjjzpaxVjEJJhDbiIKCrhCaiVcQwEJBAoJD68o14VTM0/mOFQ+231iR0B1RUdzvEI89SosLjC6+gBnhAAAOw==";var l="data:image/gif;base64,R0lGODlhIAAgALMAAGZmZpOTk93d3Wtra8zMzLW1tXNzc3p6eu/v78XFxYODg9bW1qWlpejo6Pj4+IqKiiH5BAEHAA4ALAAAAAAgACAAAATr0MlJq7046827p4QBGMTHicBoVohApTAlIN4yjE1TwGmRH4DBooMa3XipQXFA0wiQ0ChguAHyFCUJQYE8dBqogY8BPDB0R0Pje0zYkMJEcs3ZAQKII7zx6GlCPAsMKQcuC1YMBDwkF0UpDih0DgspBghIBhdQDjcDEgEOl0EOmxaOAJApLlqVojCZFoeBgwAHQ4AAiTy2GnZ4p619AAUdeSlupwYLckFNG2BJBQgMIgYMCAVpkhpWMFg0CFuYHE9S5lMnr3o8SjBM5DcHDdhI0g1AQh+rEkgyziupKgHMsKAalYEIEypcyHBDBAA7";var n="data:image/gif;base64,R0lGODlhIAAgANUAAPX19fT09PLy8vDw8O7u7uzs7OLi4tnZ2c/Pz83NzczMzMXFxby8vLKysqmpqZ+fn5iYmJWVlZKSkoyMjICAgHx8fHl5eXZ2dnR0dHBwcG9vb21tbWtra2pqamhoaGdnZ2ZmZkxMTEpKSv///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEHACMALAAAAAAgACAAAAauwJFwSCwaj8ikcln5OJ/QqFRKnFqv0OpnyR05tV3mdvgNC87GslCtFbnf7/R4PTfLwfYjm41I+P+AgYB7cyAZG4iJiouIdHh5RYSQd2R1Sg0RDwwAkXV8R5iGoguPXpZGDKKqIAeVpXqrqq6zSbGyjrSgtqO4vbq7rL5Ylbumhm0eycoSQ6GxfYqQD8+TqNMTDgXV23nY0A3cyMHhdBqG4OSmBgvj5BEGQgvo6WFBADs=";var j=null,a=false,m=[];b.debugLogging=true;b.version="1.0";b.markPageLoaded=function(){a=true};b.launchRDP=function(u,r){var t=800,o=600,s=24;if(r!=undefined){var q=r.split("x");t=parseInt(q[0]);o=parseInt(q[1]);if(q.length>2){s=parseInt(q[2])}}var p=window.open("http://cernvm.cern.ch/releases/webapi/webrdp/webclient.html#"+u+","+t+","+o,"WebRDPClient","width="+t+",height="+o);p.moveTo((screen.width-t)/2,(screen.height-o)/2);setTimeout(function(){p.focus()},100);p.focus()};b.startCVMWebAPI=function(r,q,o){var p=function(){var s=new b.WebAPIPlugin();s.connect(function(v){if(v){r(s)}else{var w=document.createElement("iframe");w.src="//cernvm-online.cern.ch";w.width="100%";w.height=400;w.frameBorder=0;var u=document.createElement("div"),t=c.createButton("Click here to try again","#E1E1E1");u.appendChild(t);c.createFramedWindow(w,false,u,l);t.onclick=function(){s=new b.WebAPIPlugin();s.connect(function(x){if(x){r(s);c.hideInteraction()}})}}})};if(!a){m.push(p)}else{p()}};b.EventDispatcher=function(o){this.events={}};b.EventDispatcher.prototype.__fire=function(p,o){if(b.debugLogging){console.log("Firing",p,"(",o,")")}if(this.events[p]==undefined){return}var r=this.events[p];for(var q=0;q<r.length;q++){r[q].apply(this,o)}};b.EventDispatcher.prototype.addEventListener=function(o,p){if(this.events[o]==undefined){this.events[o]=[]}this.events[o].push(p)};b.EventDispatcher.prototype.removeEventListener=function(o,q){if(this.events[o]==undefined){return}var p=this.events[o].indexOf(q);if(p<0){return}this.events.splice(p,1)};b.ProgressFeedback=function(){};var g="ws://127.0.0.1:5624",e="cernvm-webapi:";b.Socket=function(){b.EventDispatcher.call(this);this.interaction=new c(this);this.connecting=false;this.connected=false;this.socket=null;this.lastID=0;this.responseCallbacks={};this.authToken="";if(window.location.hash){this.authToken=window.location.hash.substr(1)}};b.Socket.prototype=Object.create(b.EventDispatcher.prototype);b.Socket.prototype.__handleClose=function(){this.__fire("disconnected");c.hideInteraction()};b.Socket.prototype.__handleOpen=function(o){this.__fire("connected",o.version)};b.Socket.prototype.__handleData=function(q){var r=JSON.parse(q);if(r.id){var p=this.responseCallbacks[r.id];if(p!=undefined){p(r)}}else{if(r.type=="event"){var q=r.data;if(r.name=="interact"){this.interaction.handleInteractionEvent(r.data)}else{this.__fire(r.name,r.data)}}}};b.Socket.prototype.send=function(q,r,t,s){var v=this;var w="a-"+(++this.lastID);var o={type:"action",name:q,id:w,data:r||{}};if(t){var u=null,p=function(x){if(!x){return""}return"on"+x[0].toUpperCase()+x.substr(1)};if(s!==0){u=setTimeout(function(){delete v.responseCallbacks[w];if(t.onError){t.onError("Response timeout")}},s||10000)}this.responseCallbacks[w]=function(y){if(u!=null){clearTimeout(u)}if((y.name=="succeed")||(y.name=="failed")){delete v.responseCallbacks[w]}var x=p(y.name);if(t[x]){t[x].apply(v,y.data||[])}}}this.socket.send(JSON.stringify(o))};b.Socket.prototype.close=function(){if(!this.connected){return}this.socket.close();this.connected=false;this.__handleClose()};b.Socket.prototype.connect=function(r){var q=this;if(this.connected){return}if(this.connecting){return}this.connecting=true;var u=function(v,y){try{if(!y){y=100}var x=false,A=setTimeout(function(){x=true;v(false)},y);var w=new WebSocket(g);w.onerror=function(B){if(x){return}clearTimeout(A);if(!q.connecting){return}v(false)};w.onopen=function(B){if(x){return}clearTimeout(A);if(!q.connecting){return}v(true,w)}}catch(z){console.warn("[socket] Error setting up socket! ",z);if(x){return}v(false)}};var p=function(z,B,E,w){var x=new Date().getTime();if(!w){w=x}if(!E){E=50}var v=B-(x-w);var y=false,C=setTimeout(function(){y=true;z(false)},v);var D=function(G,F){if(y){return}if(G){clearTimeout(C);z(true,F)}else{if(v<E){return}clearTimeout(C);setTimeout(function(){p(z,B,E,w)},E)}};var A=100;if(v<A){A=v}u(D,A)};var o=function(v){q.connecting=false;q.connected=true;q.socket=v;q.socket.onclose=function(){console.warn("Remotely disconnected from CernVM WebAPI");q.__handleClose()};q.socket.onmessage=function(w){q.__handleData(w.data)};q.send("handshake",{version:b.version,auth:q.authToken},function(y,x,w){console.info("Successfuly contacted with CernVM WebAPI v"+y.version);q.__handleOpen(y)});if(r){r(true)}};var t=function(v){console.error("Unable to contact CernVM WebAPI");if(!q.connecting){return}q.connecting=false;q.connected=false;if(r){r(false)}};var s=function(w,v){if(!w){t()}else{o(v)}};u(function(w,v){if(w){o(v)}else{var x=document.createElement("iframe");x.src=e+"launch";x.style.display="none";document.body.appendChild(x);p(s,5000)}})};var d=1,k=2,h=256;var c=b.UserInteraction=function(o){var p=this;this.socket=o;this.onResize=null;window.addEventListener("resize",function(){console.log("RESIZE!");if(p.onResize){p.onResize()}})};c.hideInteraction=function(){if(c.activeScreen!=null){try{document.body.removeChild(c.activeScreen)}catch(o){}c.activeScreen=null}};c.createButton=function(r,s){var p=document.createElement("button");p.innerHTML=r;p.style.display="inline-block";p.style.marginBottom="0";p.style.textAlign="center";p.style.verticalAlign="middle";p.style.borderStyle="solid";p.style.borderWidth="1px";p.style.borderRadius=p.style.webkitBorderRadius=p.style.mozBorderRadius="4px";p.style.userSelect=p.style.webkitUserSelect=p.style.mozUserSelect=p.style.msUserSelect="none";p.style.margin="5px";p.style.padding="6px 12px";p.style.cursor="pointer";var o=function(t,x){var u=parseInt(t.slice(1),16),z=Math.round(2.55*x),w=(u>>16)+z,v=(u>>8&255)+z,y=(u&255)+z;return"#"+(16777216+(w<255?w<1?0:w:255)*65536+(v<255?v<1?0:v:255)*256+(y<255?y<1?0:y:255)).toString(16).slice(1)},q=function(x){var u=parseInt(x.slice(1),16),w=(u>>16),v=(u>>8&255),t=(u&255),y=(w*299+v*587+t*114)/1000;return(y>=128)?"black":"white"};p.style.backgroundColor=s;p.style.borderColor=o(s,-20);p.onmouseover=function(){p.style.backgroundColor=o(s,-10)};p.onmouseout=function(){p.style.backgroundColor=s};p.style.color=q(s);return p};c.createFramedWindow=function(s,r,A,y,u){var x=document.createElement("div"),w=document.createElement("div"),p=document.createElement("div"),t=document.createElement("div"),q=document.createElement("div");x.style.position="absolute";x.style.left="0";x.style.top="0";x.style.right="0";x.style.bottom="0";x.style.zIndex=60000;x.style.backgroundColor="rgba(255,255,255,0.8)";x.appendChild(w);w.style.marginLeft="auto";w.style.marginRight="auto";w.style.marginBottom=0;w.style.marginTop=0;w.style.backgroundColor="#FCFCFC";w.style.border="solid 1px #E6E6E6";w.style.borderRadius=w.style.webkitBorderRadius=w.style.mozBorderRadius="5px";w.style.boxShadow=w.style.webkitBoxShadow=w.style.mozBoxShadow="1px 2px 4px 1px rgba(0,0,0,0.2)";w.style.padding="10px";w.style.fontFamily="Verdana, Geneva, sans-serif";w.style.fontSize="14px";w.style.color="#666;";w.style.width="70%";p.style.color="#333";p.style.marginBottom="8px";t.style.textAlign="center";t.style.color="#333";t.style.marginTop="8px";w.appendChild(p);if(r){if(typeof(r)=="string"){var v;if(y){v=document.createElement("img");v.src=y;v.style.verticalAlign="-8px";v.style.marginRight="6px"}else{v=document.createElement("span")}var o=document.createElement("span");o.innerHTML=r;o.style.fontSize="1.6em";o.style.marginBottom="8px";p.appendChild(v);p.appendChild(o)}else{p.appendChild(r)}}if(s){q.style.overflow="auto";q.appendChild(s)}w.appendChild(q);w.appendChild(t);if(A){if(typeof(A)=="string"){t.innerHTML=A}else{t.appendChild(A)}}var z=function(){var B=p.offsetHeight+t.offsetHeight+50;var D=window.innerHeight-B;q.style.maxHeight=D+"px";var C=(window.innerHeight-w.offsetHeight)/2;if(C<0){C=0}w.style.marginTop=C+"px"};x.onclick=function(){if(u){u()}else{c.hideInteraction()}};w.onclick=function(B){B.stopPropagation()};c.hideInteraction();document.body.appendChild(x);c.activeScreen=x;z();this.onResize=z;return x};c.displayLicenseWindow=function(w,t,r,v,q){var s=document.createElement("div"),x=document.createElement("span"),p;x.innerHTML="&nbsp;";if(r){p=document.createElement("iframe"),p.src=t;p.width="100%";p.height=450;p.frameBorder=0}else{p=document.createElement("div");p.width="100%";p.style.height="450px";p.style.display="block";p.innerHTML=t}var o=c.createButton("Accept License","#E1E1E1");lnkCancel=c.createButton("Decline License","#FAFAFA");s.style.padding="6px";s.appendChild(o);s.appendChild(x);s.appendChild(lnkCancel);var u;u=c.createFramedWindow(p,w,s,n,function(){document.body.removeChild(u);if(q){q()}});o.onclick=function(){document.body.removeChild(u);if(v){v()}};lnkCancel.onclick=function(){document.body.removeChild(u);if(q){q()}}};c.confirm=function(t,o,v){var s=document.createElement("div"),u=document.createElement("div");s.innerHTML=o;s.style.width="100%";var r,q=c.createButton("Ok","#E1E1E1"),p=c.createButton("Cancel","#FAFAFA");q.onclick=function(){document.body.removeChild(r);v(true)};p.onclick=function(){document.body.removeChild(r);v(false)};u.appendChild(q);u.appendChild(p);r=c.createFramedWindow(s,t,u,i,function(){document.body.removeChild(r);v(false)})};c.alert=function(s,o,u){var r=document.createElement("div"),t=document.createElement("div");r.innerHTML=o;r.style.width="100%";var q,p=c.createButton("Ok","#FAFAFA");p.onclick=function(){document.body.removeChild(q)};t.appendChild(p);q=c.createFramedWindow(r,s,t,f)};c.confirmLicense=function(p,o,q){c.displayLicenseWindow(p,o,false,function(){q(true)},function(){q(false)})};c.confirmLicenseURL=function(p,o,q){c.displayLicenseWindow(p,o,true,function(){q(true)},function(){q(false)})};c.prototype.handleInteractionEvent=function(p){var o=this.socket;if(p[0]=="confirm"){c.confirm(p[1],p[2],function(q,r){if(q){o.send("interactionCallback",{result:d|(r?h:0)})}else{o.send("interactionCallback",{result:k|(r?h:0)})}})}else{if(p[0]=="alert"){c.alert(p[1],p[2],function(q){})}else{if(p[0]=="confirmLicense"){c.confirmLicense(p[1],p[2],function(q,r){if(q){o.send("interactionCallback",{result:d|(r?h:0)})}else{o.send("interactionCallback",{result:k|(r?h:0)})}})}else{if(p[0]=="confirmLicenseURL"){c.confirmLicenseURL(p[1],p[2],function(q,r){if(q){o.send("interactionCallback",{result:d|(r?h:0)})}else{o.send("interactionCallback",{result:k|(r?h:0)})}})}}}}};b.WebAPIPlugin=function(){b.Socket.call(this)};b.WebAPIPlugin.prototype=Object.create(b.Socket.prototype);b.WebAPIPlugin.prototype.stopService=function(){this.send("stopService")};b.WebAPIPlugin.prototype.requestSession=function(r,q,p){var o=this;this.send("requestSession",{vmcp:r},{onSucceed:function(u,s){var t=new b.WebAPISession(o,s);o.responseCallbacks[s]=function(v){t.handleEvent(v)};if(q){q(t)}},onFailed:function(t,s){console.error("Failed to request session! "+t);if(p){p(t,s)}},onProgress:function(t,s){o.__fire("progress",[t,s])},onStarted:function(s){o.__fire("started",[s])},onCompleted:function(s){o.__fire("completed",[s])}})};b.WebAPISession=function(o,q){b.EventDispatcher.call(this);this.socket=o;this.session_id=q;var p=undefined;Object.defineProperties(this,{state:{get:function(){return p}},stateName:{get:function(){return p}},ip:{get:function(){return p}},ram:{get:function(){return p}}})};b.WebAPISession.prototype=Object.create(b.EventDispatcher.prototype);b.WebAPISession.prototype.handleEvent=function(o){this.__fire(o.name,o.data)};b.WebAPISession.prototype.start=function(o){this.socket.send("start",{session_id:this.session_id,parameters:o||{}})};b.WebAPISession.prototype.stop=function(){this.socket.send("stop",{session_id:this.session_id})};b.WebAPISession.prototype.pause=function(){this.socket.send("pause",{session_id:this.session_id})};b.WebAPISession.prototype.resume=function(){this.socket.send("resume",{session_id:this.session_id})};b.WebAPISession.prototype.reset=function(){this.socket.send("reset",{session_id:this.session_id})};b.WebAPISession.prototype.hibernate=function(){this.socket.send("hibernate",{session_id:this.session_id})};b.WebAPISession.prototype.close=function(){this.socket.send("close",{session_id:this.session_id})};b.WebAPISession.prototype.get=function(p,o){this.socket.send("get",{session_id:this.session_id,key:p},{onSucceed:function(q){o(q)}})};b.WebAPISession.prototype.openRDPWindow=function(p,o){this.get("rdpURL",function(r){var q=r.split("@");b.launchRDP(q[0],q[1])})};if(window.jQuery==undefined){if(a){return}window.addEventListener("load",function(p){a=true;for(var o=0;o<m.length;o++){m[o]()}})}else{jQuery(function(){if(a){return}a=true;for(var o=0;o<m.length;o++){m[o]()}})}})(window.CVM);